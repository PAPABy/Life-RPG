<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Life RPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#0b0f1a;
  color:white;
  font-family:Arial, sans-serif;
  padding:20px;
}

.card {
  background:#11162a;
  border-radius:24px;
  padding:20px;
  max-width:500px;
  margin:auto;
}

.avatar img{
  width:100%;
  height:100%;
  border-radius:50%;
  object-fit:cover;
}

.avatar {
  width:90px;
  height:90px;
  border-radius:50%;
  margin:10px auto;
  background:linear-gradient(135deg,#00ffcc,#0066ff);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
}

h1 { text-align:center; }

.tabs {
  display:flex;
  gap:10px;
  margin:10px 0 20px;
}

.tabs button {
  flex:1;
  background:#1f2440;
  border:none;
  color:white;
  padding:8px;
  border-radius:10px;
}

.tabs button.active {
  background:#00ffcc;
  color:black;
}

.rank {
  text-align:center;
  margin-bottom:10px;
  color:#00ffcc;
}

/* EXP */
.exp-bar {
  height:14px;
  background:#1f2440;
  border-radius:10px;
  overflow:hidden;
}

.exp-fill {
  height:100%;
  background:linear-gradient(90deg,#ffd700,#ff9f00);
  width:0%;
  transition:.3s;
}

.level {
  text-align:center;
  font-size:14px;
  margin:6px 0 20px;
}

.quest {
  background:#1a1f3c;
  padding:12px;
  border-radius:14px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.quest button {
  background:#00ffcc;
  border:none;
  border-radius:8px;
  padding:6px 10px;
}

/* STATS */
.stat {
  margin-bottom:18px;
}

.label {
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:6px;
}

.bar {
  height:12px;
  background:#1f2440;
  border-radius:10px;
  overflow:hidden;
}

.fill {
  height:100%;
  border-radius:10px;
  transition:.3s;
}

.uploadBtn{
  display:block;
  margin:10px auto;
  padding:6px 12px;
  background:#1f2440;
  border-radius:10px;
  text-align:center;
  font-size:14px;
}

input[type=range] {
  width:100%;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="card">
 <div class="avatar" id="avatar">ðŸ§™</div>
<label class="uploadBtn">
  Ganti Avatar
  <input type="file" accept="image/*" id="avatarUpload" hidden>
</label>
  
  <h1>Life RPG</h1>
  <div class="rank" id="rankText">RANK: NOVICE</div>

  <div class="tabs">
    <button id="tabStats" class="active">Stats</button>
    <button id="tabGame">Game</button>
  </div>

  <!-- STATS MODE -->
  <div id="statsMode"></div>

  <!-- GAME MODE -->
  <div id="gameMode" style="display:none">
    <div class="exp-bar"><div class="exp-fill" id="expFill"></div></div>
    <div class="level" id="levelText"></div>

    <h3>Daily Quests</h3>
    <div id="quests"></div>

    <button onclick="devResetDay()" style="margin-top:10px;width:100%">
      ðŸ”„ Dev: Reset Day
    </button>
  </div>
</div>

<script>
const STORAGE = "life_rpg_full";

const statConfig = {
  discipline:{label:"Discipline",color:"#4facfe"},
  physical:{label:"Physical",color:"#ff4d4d"},
  financial:{label:"Financial",color:"#ffd700"},
  mental:{label:"Mental",color:"#b983ff"},
  social:{label:"Social",color:"#2ecc71"},
  relationship:{label:"Relationship",color:"#ff6fae"}
};

function save(){
  localStorage.setItem(STORAGE,JSON.stringify({
    stats,game,avatar:avatarData
  }));
}

let stats = {};
Object.keys(statConfig).forEach(k=>stats[k]=5);

let game = {
  level:1,
  exp:0,
  expMax:100,
  completed:{},
  lastDay:new Date().toDateString()
};

let avatarData = null;

// LOAD
const saved = localStorage.getItem(STORAGE);
if(saved){
  const data = JSON.parse(saved);
  stats = data.stats || stats;
  game = data.game || game;
  avatarData = data.avatar || null;
}

// SAVE

/* ---------- STATS ---------- */
const statsBox = document.getElementById("statsMode");

function createStat(k){
  const s = statConfig[k];
  const div = document.createElement("div");
  div.className="stat";
  div.innerHTML=`
    <div class="label">
      <span>${s.label}</span>
      <span id="${k}Value"></span>
    </div>
    <div class="bar">
      <div class="fill" id="${k}Bar" style="background:${s.color}"></div>
    </div>
    <input id="${k}Input" type="range" min="0" max="10" step="0.1">
  `;
  statsBox.appendChild(div);

  document.getElementById(k+"Input").oninput=e=>{
    stats[k]=parseFloat(e.target.value);
    updateStatUI(k);
    updateRank();
    updateAvatar();
    save();
  };

  updateStatUI(k);
}

function updateStatUI(k){
  document.getElementById(k+"Value").innerText=stats[k].toFixed(1);
  document.getElementById(k+"Bar").style.width=(stats[k]*10)+"%";
  document.getElementById(k+"Input").value=stats[k];
}

/* ---------- GAME ---------- */
const quests = [
  {id:"discipline",text:"Discipline Task (+25 EXP)"},
  {id:"physical",text:"Physical Activity (+25 EXP)"},
  {id:"mental",text:"Mental Care (+25 EXP)"},
  {id:"social",text:"Social Interaction (+25 EXP)"}
];

function updateGameUI(){
  document.getElementById("expFill").style.width=(game.exp/game.expMax*100)+"%";
  document.getElementById("levelText").innerText=
    `Level ${game.level} â€¢ EXP ${game.exp} / ${game.expMax}`;
}

function completeQuest(id){
  if(game.completed[id]) return;
  game.completed[id] = true;

  let base = 25;
  let projectedLevel = game.level;

  // cek apakah quest ini akan bikin level naik
  if(game.exp + base >= game.expMax){
    projectedLevel++;
  }

  let gain = base;
  if(projectedLevel >= 8){
    gain = Math.floor(base * 1.5);
  }

  game.exp += gain;

  if(game.exp >= game.expMax){
    game.level++;
    game.exp = 0;
    game.expMax = Math.floor(game.expMax * 1.25);
  }

  updateRank();
  renderQuests();
  updateGameUI();
  save();
}

function renderQuests(){
  const qbox=document.getElementById("quests");
  qbox.innerHTML="";
  quests.forEach(q=>{
    const done=game.completed[q.id];
    const div=document.createElement("div");
    div.className="quest";
    div.innerHTML=`
      <span>${q.text}</span>
      <button ${done?"disabled":""}>${done?"âœ“":"Done"}</button>
    `;
    div.querySelector("button").onclick=()=>completeQuest(q.id);
    qbox.appendChild(div);
  });
}

function checkDay(){
  const today=new Date().toDateString();
  if(game.lastDay!==today){
    game.completed={};
    game.lastDay=today;
  }
}

function devResetDay(){
  game.completed={};
  game.lastDay=new Date().toDateString();
  renderQuests();
  save();
}

/* ---------- RANK ---------- */
function updateRank(){
  const avg=Object.values(stats).reduce((a,b)=>a+b,0)/Object.keys(stats).length;
  let rank="NOVICE";
  if(avg>=3) rank="APPRENTICE";
  if(avg>=6) rank="WARRIOR";
  if(avg>=9) rank="MASTER";
  document.getElementById("rankText").innerText="RANK: "+rank;
}

function updateAvatar(){
  const avg = Object.values(stats).reduce((a,b)=>a+b,0)/Object.keys(stats).length;
  const avatar = document.getElementById("avatar");

  avatar.innerHTML = ""; // ðŸ”´ PENTING

  if(avatarData){
    const img = document.createElement("img");
    img.src = avatarData;
    avatar.appendChild(img);
    return;
  }

  let icon="ðŸ§";
  if(avg>=3) icon="ðŸ§™";
  if(avg>=6) icon="ðŸ›¡ï¸";
  if(avg>=9) icon="ðŸ‘‘";

  avatar.textContent = icon;
}

/* ---------- TABS ---------- */
document.getElementById("tabStats").onclick=()=>{
  statsMode.style.display="block";
  gameMode.style.display="none";
  tabStats.classList.add("active");
  tabGame.classList.remove("active");
};

document.getElementById("tabGame").onclick=()=>{
  statsMode.style.display="none";
  gameMode.style.display="block";
  tabGame.classList.add("active");
  tabStats.classList.remove("active");
};

document.getElementById("avatarUpload").onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;

  const reader=new FileReader();
  reader.onload=()=>{
    avatarData=reader.result;
    updateAvatar();
    save();
  };
  reader.readAsDataURL(file);
};

/* INIT */
Object.keys(statConfig).forEach(createStat);
checkDay();
renderQuests();
updateAvatar();
updateRank();
updateGameUI();
save();
document.getElementById("tabStats").click();
</script>

</body>
</html>
